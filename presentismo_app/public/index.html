<!DOCTYPE html>
<html>
<head>
    <title>Carga de Asistencia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(() => {
            const alertPlaceholder = $(`#liveAlertPlaceholder`);
            const appendAlert = (message, type) => {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = [
                    `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                    `   <div>${message}</div>`,
                    '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                    '</div>'
                ].join('');

                alertPlaceholder.append(wrapper);
            }

            const init = () => {
                let today = new Date();
                let dd = ("0" + (today.getDate())).slice(-2);
                let mm = ("0" + (today.getMonth() + 1)).slice(-2);
                let yyyy = today.getFullYear();
                today = yyyy + '-' + mm + '-' + dd;
                $("#dia_").attr("value", today);

                let m_ = "";
                switch ((new Date()).getDay()) {
                    case 4: {
                        m_ = "DB";
                        break;
                    }
                    case 2:
                    case 3:
                    case 5: {
                        m_ = "LPI";
                        break;
                    }
                }
                $(`#materia_`).attr(`value`, m_);

            }

            // Function to submit attendance
            const submitAttendance = () => {
                const studentName = $('#dniAlumno_').val();
                const subject = $('#materia_').val();
                const date = $('#dia_').val();

                if (!studentName) {
                    appendAlert(`No se agrego DNI del alumno`, `warning`);
                } else {
                    $.post('/attendance', { studentName, subject, date }, (response) => {
                        if (response === 'Attendance already submitted') {
                            appendAlert(`El alumno ya presento su asistencia`, `danger`);
                        } else {
                            appendAlert(`Agregado con exito!`, `success`);
                            $('#studentName').val('');
                            $('#subject').val('');
                            $('#date').val('');
                        }
                    });
                }
                
            };

            // Event handler for submit button click
            $('#submitBtn').click(() => {
                submitAttendance();
            });

            init();
        });
    </script>
    <style>
        body {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="liveAlertPlaceholder"></div>
    <h1 class="mt-5 text-center">Ingreso de Asistencia</h1>

    <div class="container">
        <div class="mb-3">
            <label for="dniAlumno" class="form-label">DNI Alumno</label>
            <input type="text" class="form-control" id="dniAlumno_" placeholder="23456789">
        </div>
        <div class="mb-3">
            <label for="dia" class="form-label">Dia</label>
            <input type="date" class="form-control" id="dia_" value="" placeholder="ie: 22/05/1999" disabled>
        </div>
        <div class="mb-3">
            <label for="materia" class="form-label">Materia</label>
            <input type="text" class="form-control" id="materia_" value="" placeholder="ie: Laboratorio de programacion I" disabled>
        </div>
        <div class="mb-3">
            <button type="submit" class="btn btn-primary" id="submitBtn">Dar Presentismo</button>
        </div>
    </div>
</body>
</html>